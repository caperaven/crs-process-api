/**
 * Handle the actions when the mouse is released and the drop action takes place.
 * @param dragElement
 * @param placeholder
 * @param options
 * @returns {Promise<void>}
 */
export async function drop(dragElement, placeholder, options) {
    await gotoOrigin(dragElement, placeholder);
    cleanElements(dragElement, placeholder);
}

/**
 * Move back to where you started the drag operation from
 * @param dragElement
 * @param placeholder
 * @returns {Promise<void>}
 */
async function gotoOrigin(dragElement, placeholder) {
    await gotoBounds(dragElement, placeholder._bounds);

    if (dragElement._dragElement != null) {
        const element = dragElement._dragElement;
        delete dragElement._dragElement;
        dragElement = element;
    }

    placeholder.parentElement.replaceChild(dragElement, placeholder);
}

/**
 * Move the drag element to a defined bounds
 * @param bounds
 * @returns {Promise<unknown>}
 */
function gotoBounds(element, bounds) {
    return new Promise(resolve => {
        const start = setTimeout(() => {
            element.style.transition = "translate 0.3s ease-out";
            element.style.translate = `${bounds.x}px ${bounds.y}px`;
        });

        const wait = setTimeout(() => {
            clearTimeout(start);
            clearTimeout(wait);
            element.parentElement.removeChild(element);
            resolve();
        }, 350);
    })
}

/**
 * Once done with the drag and drop ensure that all properties are cleaned up
 * @param dragElement
 * @param placeholder
 */
function cleanElements(dragElement, placeholder) {
    delete dragElement._bounds;
    dragElement.style.width = "";
    dragElement.style.height = "";
    dragElement.style.rotate = "";
    dragElement.style.translate = "";
    dragElement.style.transition = "";
    dragElement.style.filter = "";

    delete placeholder._bounds;
}
